<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>{{ site.title }}{% if page.title %} : {{ page.title }}{% endif %}</title>
        <meta name="description" content="{{ site.subtitle }}">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="{{ site.baseurl }}/css/syntax.css">
        <link rel="stylesheet" href="{{ site.baseurl }}/css/main.css">
        <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
    </head>
    <body>
        <!-- Search code from https://github.com/slashdotdash/jekyll-lunr-js-search -->
        <script type="text/javascript">
            $(function() {
                $('#search-query').lunrSearch({
                    indexUrl: '/search.json',             // URL of the `search.json` index data for your site
                    results:  '#search-results',          // jQuery selector for the search results container
                    entries:  '.entries',                 // jQuery selector for the element to contain the results list, must be a child of the results element above.
                    template: '#search-results-template'  // jQuery selector for the Mustache.js template
                });
            });
        </script>

        {% raw %}
        <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <article>
              <h3>
                {{#date}}<small><time datetime="{{pubdate}}" pubdate>{{displaydate}}</time></small>{{/date}}
                <a href="{{url}}">{{title}}</a>
              </h3>
            </article>
          {{/entries}}
        </script>
        {% endraw %}
        <!-- End of search code -->

        <div class="container">
            <div class=row-fluid id=header>
                <div id=site-title class=span8>
                    {% include header.html %}
                </div>
                <div id=search class=span4>
                  <form action="#" method="get">
                    <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off">
                  </form>
                </div>
            </div>

            <div class=row-fluid>
                <div id=navigation class=span2>
                    {% include navigation.html %}
                </div>

                <div id=content class=span10>
                    {% include search_results.html %}

                    <h1>{{ page.title }}
                        {% if page.subtitle %}<small>{{ page.subtitle }}</small>{% endif %}
                    </h1>

                    {{ content }}
                </div>
            </div>

            <div class=row-fluid>
                <div id=footer class=span12>
                    {% include footer.html %}
                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
